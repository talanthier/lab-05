---
title: "Lab 5"
author: "Tim Lanthier"
date: "2/16/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(knitr)
library(skimr)
library(broom)
```

## Lab 5: Data Wrangling & Regression
The data we will be working with is Airbnb listings. The data can be obtained through the following link:

[http://insideairbnb.com/get-the-data.html](http://insideairbnb.com/get-the-data.html)

For this lab we will only be using the listings data from Santa Cruz County, CA.

### Data Wrangling & EDA

Since some airbnb rentals have cleaning fees, we will create a new variable `cleaning_fee` which is 2\% of the price per night.
```{r}
airbnb <- read.csv('data/listings.csv') %>%
  mutate(cleaning_fee = 0.02*price)
```
The distribution for `cleaning_fee` is shown below.
```{r}
ggplot(data = airbnb, aes(cleaning_fee)) + 
  geom_histogram(binwidth = 3) +
  labs(x = 'Cleaning Fee', title = 'Distribution of Cleaning Fee')
summarise(airbnb, mean = mean(cleaning_fee),
          sd = sd(cleaning_fee),
          min = min(cleaning_fee),
          q1 = quantile(cleaning_fee, 0.25),
          median = median(cleaning_fee),
          q3 = quantile(cleaning_fee, 0.75),
          max = max(cleaning_fee),
          IQR = q3-q1)
```
Looking at the above histogram, we see that `cleaning_fee` is heavily positively skewed as shown with most of the data being concentrated around 5 with a long right hand tail. This is supported by the fact that we have a median of 5 with a larger mean of 6.378. We also appear to have quite a few outliers. Looking at our quantiles, 75\% of listings' cleaning fees are below \$8.06, but we have a maximum cleaning fee of \$59. 

Now we will take a look at `neighbourhood`.
```{r}
ggplot(data = airbnb, aes(neighbourhood)) + 
  geom_bar() +
  labs(x = 'Neighborhood', title = 'Distribution of Neighborhood')
```
So we have 5 different values for `neighbourhood`: City of Capitola, City of Santa Cruz, City of Scotts Valley, City of Watsonville, and Unincorporated Areas. As shown by the above plot, most of the listings within Santa Cruz County are in Unincorporated Areas. The city of Santa Cruz and Capitola have the second and third most listings respectively. Meanwhile Scotts Valley and Watsonville have significantly fewer listings than the rest.

```{r}
airbnb %>% count(neighbourhood) %>% mutate(percent = n/sum(n))
```
As shown in the output above, Unincorporated areas, the City of Santa Cruz, and the City of Capitola account for 57.8\%, 24.8\%, and 14.6\% of listings in Santa Cruz County respectively. Meanwhile the cities of Scotts Valley and Watsonville combined account for less than 3\% of Santa Cruz County Airbnb listings. Seeing as Scotts Valley and Watsonville account for so few listings, we will lump them into a single category as the new variable `neigh_simp`.

```{r} 
airbnb <- airbnb %>% 
  mutate(neigh_simp = fct_lump_n(neighbourhood,3,other_level = 'Scotts Valley/Watsonville'))

ggplot(data = airbnb, aes(neigh_simp)) + 
  geom_bar() +
  labs(x = 'Simplified Neighborhood', title = 'Distribution of Simplified Neighborhood')
```
Now we will take a look at `minimum_nights`.
```{r}
ggplot(data = airbnb, aes(minimum_nights)) + 
  geom_histogram(binwidth = 1) +
  labs(x = 'Minimum Nights', title = 'Distribution of Minimum Nights')
sort(summary(as.factor(airbnb$minimum_nights)),decreasing = TRUE)
```
The distribution for `minimum_nights` is shown above. Once again, the distribution for minimum number of nights is positively skewed with most of the data concentrated near 0, but we do have a spike around the 30 mark. Looking at the counts for each category, the 4 most common values for minimum nights is 2,1,3, and 30. The one that stands out of course is 30 which is the unusual spike we noticed earlier. While listings with 1,2, or 3 minimum nights are likely used for tourists, those with a value of 30 minimum nights is likely intended for those who are looking for more long term housing in the Santa Cruz area. Since we want to focus on listings intended for travel purposes, for the remainder of the lab we will filter out observations with a minimum nights of over 3.
```{r}
airbnb <- airbnb %>% filter(minimum_nights <= 3)
ggplot(airbnb, aes(minimum_nights)) +
  geom_histogram(binwidth = 1) +
  labs(x = 'Minimum Nights', title = 'Distribution of Minimum Nights for Filtered Dataset')
```
We will use this dataset for the remainder of the lab.
